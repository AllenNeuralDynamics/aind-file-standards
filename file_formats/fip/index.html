<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation for the Allen Institute for Neural Dynamics File Standards"><meta name=author content="Allen Institute for Neural Dynamics and Contributors"><link href=../ecephys/ rel=prev><link href=../harp/ rel=next><link rel=icon href=../../icon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.16"><title>Fip - AIND File Standards</title><link rel=stylesheet href=../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=black> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#standards-on-fip-fiber-photometry-acquisition class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="AIND File Standards" class="md-header__button md-logo" aria-label="AIND File Standards" data-md-component=logo> <img src=../../logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AIND File Standards </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Fip </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=black aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=white aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/AllenNeuralDynamics/aind-file-standards title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> aind-file-standards </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Index </a> </li> <li class=md-tabs__item> <a href=../../core/contributing/ class=md-tabs__link> Core </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../behavior_videos/ class=md-tabs__link> File Formats </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="AIND File Standards" class="md-nav__button md-logo" aria-label="AIND File Standards" data-md-component=logo> <img src=../../logo.svg alt=logo> </a> AIND File Standards </label> <div class=md-nav__source> <a href=https://github.com/AllenNeuralDynamics/aind-file-standards title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> aind-file-standards </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Index </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Core </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Core </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../core/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../../core/core-standards/ class=md-nav__link> <span class=md-ellipsis> Core Standards </span> </a> </li> <li class=md-nav__item> <a href=../../core/template/ class=md-nav__link> <span class=md-ellipsis> Template </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> File Formats </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> File Formats </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../behavior_videos/ class=md-nav__link> <span class=md-ellipsis> Behavior Videos </span> </a> </li> <li class=md-nav__item> <a href=../ecephys/ class=md-nav__link> <span class=md-ellipsis> Ecephys </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Fip </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Fip </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Page contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Page contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#version class=md-nav__link> <span class=md-ellipsis> Version </span> </a> </li> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=#raw-data-format class=md-nav__link> <span class=md-ellipsis> Raw Data Format </span> </a> <nav class=md-nav aria-label="Raw Data Format"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#file-format class=md-nav__link> <span class=md-ellipsis> File format </span> </a> <nav class=md-nav aria-label="File format"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fluorescence-data class=md-nav__link> <span class=md-ellipsis> Fluorescence data </span> </a> </li> <li class=md-nav__item> <a href=#raw-sensor-data class=md-nav__link> <span class=md-ellipsis> Raw sensor data </span> </a> </li> <li class=md-nav__item> <a href=#sensor-background-data-optional class=md-nav__link> <span class=md-ellipsis> Sensor background data (optional) </span> </a> </li> <li class=md-nav__item> <a href=#recovering-the-regions-of-interest class=md-nav__link> <span class=md-ellipsis> Recovering the regions of interest </span> </a> </li> <li class=md-nav__item> <a href=#camera-metadata class=md-nav__link> <span class=md-ellipsis> Camera Metadata </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#application-notes class=md-nav__link> <span class=md-ellipsis> Application notes </span> </a> <nav class=md-nav aria-label="Application notes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parsing-raw-binary-files class=md-nav__link> <span class=md-ellipsis> Parsing raw binary files </span> </a> </li> <li class=md-nav__item> <a href=#acquiring-data-under-this-format class=md-nav__link> <span class=md-ellipsis> Acquiring data under this format </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#relationship-to-aind-data-schema class=md-nav__link> <span class=md-ellipsis> Relationship to aind-data-schema </span> </a> </li> <li class=md-nav__item> <a href=#file-quality-assurances class=md-nav__link> <span class=md-ellipsis> File Quality Assurances </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../harp/ class=md-nav__link> <span class=md-ellipsis> Harp </span> </a> </li> <li class=md-nav__item> <a href=../nwb/ class=md-nav__link> <span class=md-ellipsis> Nwb </span> </a> </li> <li class=md-nav__item> <a href=../planar_ophys/ class=md-nav__link> <span class=md-ellipsis> Planar Ophys </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Page contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Page contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#version class=md-nav__link> <span class=md-ellipsis> Version </span> </a> </li> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=#raw-data-format class=md-nav__link> <span class=md-ellipsis> Raw Data Format </span> </a> <nav class=md-nav aria-label="Raw Data Format"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#file-format class=md-nav__link> <span class=md-ellipsis> File format </span> </a> <nav class=md-nav aria-label="File format"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fluorescence-data class=md-nav__link> <span class=md-ellipsis> Fluorescence data </span> </a> </li> <li class=md-nav__item> <a href=#raw-sensor-data class=md-nav__link> <span class=md-ellipsis> Raw sensor data </span> </a> </li> <li class=md-nav__item> <a href=#sensor-background-data-optional class=md-nav__link> <span class=md-ellipsis> Sensor background data (optional) </span> </a> </li> <li class=md-nav__item> <a href=#recovering-the-regions-of-interest class=md-nav__link> <span class=md-ellipsis> Recovering the regions of interest </span> </a> </li> <li class=md-nav__item> <a href=#camera-metadata class=md-nav__link> <span class=md-ellipsis> Camera Metadata </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#application-notes class=md-nav__link> <span class=md-ellipsis> Application notes </span> </a> <nav class=md-nav aria-label="Application notes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parsing-raw-binary-files class=md-nav__link> <span class=md-ellipsis> Parsing raw binary files </span> </a> </li> <li class=md-nav__item> <a href=#acquiring-data-under-this-format class=md-nav__link> <span class=md-ellipsis> Acquiring data under this format </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#relationship-to-aind-data-schema class=md-nav__link> <span class=md-ellipsis> Relationship to aind-data-schema </span> </a> </li> <li class=md-nav__item> <a href=#file-quality-assurances class=md-nav__link> <span class=md-ellipsis> File Quality Assurances </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=standards-on-fip-fiber-photometry-acquisition>Standards on FIP fiber photometry acquisition<a class=headerlink href=#standards-on-fip-fiber-photometry-acquisition title="Permanent link">&para;</a></h1> <h2 id=version>Version<a class=headerlink href=#version title="Permanent link">&para;</a></h2> <p><code>0.4.0</code></p> <h2 id=introduction>Introduction<a class=headerlink href=#introduction title="Permanent link">&para;</a></h2> <p>This document describes the standards for the acquisition of frame-projected independent-fiber photometry (FIP) data in the Allen Institute for Neural Dynamics.</p> <h2 id=raw-data-format>Raw Data Format<a class=headerlink href=#raw-data-format title="Permanent link">&para;</a></h2> <p>Following SciComp standards, FIP data should be saved in their own folder named "fib" (short for "fiber photometry"). Data from other modalities go in separate folders.</p> <h3 id=file-format>File format<a class=headerlink href=#file-format title="Permanent link">&para;</a></h3> <p>In most cases, FIP data will be saved in <code>CSV</code> files, where each file corresponds to a different channel in the photometry rig. In addition to the timeseries fluorescence data, files containing metadata and raw image data are also available. A single session of FIP data should be organized under a the <code>fib</code> directory. An acquisition for a single session should be nested under a sub directory named following the core standards for file naming convention found <a href=https://github.com/AllenNeuralDynamics/aind-file-standards/blob/main/core/core-standards.md#filename-conventions>here</a>. Mostly, this is for cases where the recording gets interrupted. When the system restarts under the same session, it can be added to a new folder. A sessions folder structure should look like the following:</p> <div class=highlight><pre><span></span><code>ðŸ“¦ fib
â”£ ðŸ“‚ &lt;fip_YYYY-MM-DDTHHMMSS&gt;
â”ƒ â”£ green.csv
â”ƒ â”£ red.csv
â”ƒ â”£ iso.csv
â”ƒ â”£ green.bin
â”ƒ â”£ red.bin
â”ƒ â”£ iso.bin
â”ƒ â”£ [Optional]background_green.bin
â”ƒ â”£ [Optional]background_red.bin
â”ƒ â”£ [Optional]background_iso.bin
â”ƒ â”£ [Optional]background_green.csv
â”ƒ â”£ [Optional]background_red.csv
â”ƒ â”£ [Optional]background_iso.csv
â”ƒ â”£ green_metadata.json
â”ƒ â”£ red_metadata.json
â”ƒ â”£ iso_metadata.json
â”ƒ â”£ camera_green_iso_metadata.csv
â”ƒ â”£ camera_red_metadata.csv
â”ƒ â”— regions.json
â”— ðŸ“‚ &lt;fip_YYYY-MM-DDTHHMMSS&gt;
  â”£ green.csv
  â”£ &lt;...&gt;
  â”— regions.json
</code></pre></div> <p>Data is generally organized by the emission channel that gave rise to the data (<code>green</code>, <code>red</code>, and <code>iso</code>), respectively. For details on the rig setup, please refer to the <a href=https://github.com/AllenNeuralDynamics/FIP_DAQ_Control>data acquisition repository</a>.</p> <h4 id=fluorescence-data>Fluorescence data<a class=headerlink href=#fluorescence-data title="Permanent link">&para;</a></h4> <p>Each fiber photometry session will primarily be analyzed by using the average signal from regions of interest (ROIs) placed on top of raw video frames during acquisition. To simplify analysis, we average the signal from all pixels within the ROIs during online acquisition and make it available as time series data in <code>CSV</code> files. These are <code>green.csv</code>, <code>red.csv</code>, and <code>iso.csv</code> files, respectively. All files share the same format, where each row corresponds to a single frame of the video and each column can be described as follows:</p> <ul> <li><code>ReferenceTime</code> Time of the trigger given by hardware (Harp)</li> <li><code>CameraFrameNumber</code> Frame counter given by the camera API</li> <li><code>CameraFrameTime</code> Frame acquisition time given by the camera API</li> <li><code>Background</code> CMOS dark count floor signal</li> <li><code>Fiber_0</code> Average signal values for Fiber_0's selected ROI</li> <li><code>&lt;...&gt;</code> (Variable number of columns)</li> <li><code>Fiber_N</code> Average signal values for Fiber_N's selected ROI.</li> </ul> <h4 id=raw-sensor-data>Raw sensor data<a class=headerlink href=#raw-sensor-data title="Permanent link">&para;</a></h4> <p>Raw sensor data (i.e., camera frames) that generated the fluorescence data is saved in raw binary files. These files share the same naming convention as the fluorescence data files, but with a <code>.bin</code> extension. During acquisition, operators place circular ROIs over the images, and photometry readouts are obtained by averaging the signal inside these regions.</p> <p>To open these files, users need additional information to parse the binary data. Data is stored in a <code>ColumnMajor</code> layout format, where each frame can be parsed with the information available in the corresponding <code>.json</code> file. Each <code>.json</code> file contains the following fields:</p> <ul> <li><code>Width</code>: Imaging width (200 px by default)</li> <li><code>Height</code>: Imaging height (200 px by default)</li> <li><code>Depth</code>: Bit depth (U16 by default)</li> <li><code>Channel</code>: Channel (1 channel by default)</li> </ul> <p>See the Application Notes section for an example of how to parse the binary files.</p> <h4 id=sensor-background-data-optional>Sensor background data (optional)<a class=headerlink href=#sensor-background-data-optional title="Permanent link">&para;</a></h4> <p>In some experiments, operators may choose to record background frames without any illumination. These frames can be used to estimate the camera's dark count floor and subtract it from the raw data during post-processing. If background frames are recorded, they will mirror the naming convention of the raw sensor data files and append <code>background_</code> to the beginning of the filename. While optional, these files are expected to still honor the <code>&lt;color&gt;_metadata.json</code> and <code>regions.json</code> specifications.</p> <p>If the background files are not present, users can assume that no background frames were recorded during the session.</p> <p>If the background files are present they must contain at least one frame (i.e. row) in the corresponding <code>&lt;color&gt;_background.csv</code> file.</p> <p>If one background file is present, all background files must be present.</p> <h4 id=recovering-the-regions-of-interest>Recovering the regions of interest<a class=headerlink href=#recovering-the-regions-of-interest title="Permanent link">&para;</a></h4> <p>The regions of interest (ROIs) used during the experiment are saved as a single <code>JSON</code> file named <code>regions.json</code>. Each ROI is defined as a <code>Circle</code> with a center coordinate (<code>[x,y]</code>) and a radius (<code>r</code>) in pixels. The units (pixels) are the same as in the parsed <code>.bin</code> file. This file contains the following fields:</p> <div class=highlight><pre><span></span><code>regions.json
â”œâ”€â”€ camera_green_iso_background: Circle[[x, y], r]
â”œâ”€â”€ camera_red_background:       Circle[[x, y], r]
â”œâ”€â”€ camera_green_iso_roi:        list of Circle[[x, y], r]
â”œâ”€â”€ camera_red_roi:              list of Circle[[x, y], r]
</code></pre></div> <p>An image like the one below can be generated by combining the previous two files.</p> <p><img alt=image src=https://github.com/user-attachments/assets/30900798-5d51-43ba-99fc-41b07d4a75dd></p> <h4 id=camera-metadata>Camera Metadata<a class=headerlink href=#camera-metadata title="Permanent link">&para;</a></h4> <p>The fiber imaging system uses a single camera to capture data from two distinct light sources (<code>iso</code> and <code>green</code> channels) through temporal multiplexing. As a result, only two metadata files are generated - one for each camera. These files can be used to ensure data integrity during post-processing. The metadata files are named as follows:</p> <ul> <li><code>camera_green_iso_metadata.csv</code>: metadata from the camera recording both green and iso channels</li> <li><code>camera_red_metadata.csv</code>: metadata from the camera recording the red channel</li> </ul> <p>Within the metadata files are the following columns:</p> <ul> <li><code>ReferenceTime</code> Time of the trigger given by hardware (Harp)</li> <li><code>CameraFrameNumber</code> Frame counter given by the camera API</li> <li><code>CameraFrameTime</code> Frame acquisition time given by the camera API</li> <li><code>CpuTime</code> Software timestamp from the OS, in timezone-aware ISO8061 format. Users should consider these timestamps low-precision and rig-dependent, and should not rely on them for analysis.</li> </ul> <p>Under expected operating conditions, these files will contain all the rows present in the <code>&lt;color&gt;.csv</code> and <code>background_&lt;color&gt;.csv</code> files.</p> <h3 id=application-notes>Application notes<a class=headerlink href=#application-notes title="Permanent link">&para;</a></h3> <h4 id=parsing-raw-binary-files>Parsing raw binary files<a class=headerlink href=#parsing-raw-binary-files title="Permanent link">&para;</a></h4> <p>These files can be read by specifying the structure of the videos as follows:</p> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span>
<span class=kn>import</span><span class=w> </span><span class=nn>json</span>


<span class=k>def</span><span class=w> </span><span class=nf>load_average_frame</span><span class=p>(</span><span class=n>video_file</span><span class=p>,</span> <span class=n>start_frame</span><span class=p>,</span> <span class=n>end_frame</span><span class=p>,</span> <span class=n>frame_size</span><span class=p>,</span> <span class=n>dtype</span><span class=p>,</span> <span class=n>frame_width</span><span class=p>,</span> <span class=n>frame_height</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Parameters:</span>
<span class=sd>        video_file (str): Path to the video file.</span>
<span class=sd>        start_frame (int): Index of the starting frame.</span>
<span class=sd>        end_frame (int): Index of the ending frame (exclusive).</span>
<span class=sd>        frame_size (int): Byte size of a single frame.</span>
<span class=sd>        dtype (numpy.dtype): Data type of the frame.</span>
<span class=sd>        frame_width (int): Width of the frame.</span>
<span class=sd>        frame_height (int): Height of the frame.</span>

<span class=sd>    Returns:</span>
<span class=sd>        numpy.ndarray: Average image (frame_height x frame_width).</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>num_frames</span> <span class=o>=</span> <span class=n>end_frame</span> <span class=o>-</span> <span class=n>start_frame</span>
    <span class=k>if</span> <span class=n>num_frames</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Invalid frame range specified.&quot;</span><span class=p>)</span>

    <span class=n>accumulated_frame</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>frame_height</span><span class=p>,</span> <span class=n>frame_width</span><span class=p>),</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float64</span><span class=p>)</span>

    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>video_file</span><span class=p>,</span> <span class=s2>&quot;rb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>frame_index</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>start_frame</span><span class=p>,</span> <span class=n>end_frame</span><span class=p>):</span>
            <span class=n>f</span><span class=o>.</span><span class=n>seek</span><span class=p>(</span><span class=n>frame_index</span> <span class=o>*</span> <span class=n>frame_size</span><span class=p>)</span>
            <span class=n>frame_data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>frombuffer</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>frame_size</span><span class=p>),</span> <span class=n>dtype</span><span class=o>=</span><span class=n>dtype</span><span class=p>)</span>

            <span class=k>if</span> <span class=n>frame_data</span><span class=o>.</span><span class=n>size</span> <span class=o>!=</span> <span class=n>frame_width</span> <span class=o>*</span> <span class=n>frame_height</span><span class=p>:</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Reached end of file.&quot;</span><span class=p>)</span>

            <span class=n>accumulated_frame</span> <span class=o>+=</span> <span class=n>frame_data</span><span class=o>.</span><span class=n>reshape</span><span class=p>((</span><span class=n>frame_height</span><span class=p>,</span> <span class=n>frame_width</span><span class=p>))</span>

    <span class=k>return</span> <span class=p>(</span><span class=n>accumulated_frame</span> <span class=o>/</span> <span class=n>num_frames</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>dtype</span><span class=p>)</span>


<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;red.meta&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>j</span><span class=p>:</span>
        <span class=n>metadata</span> <span class=o>=</span> <span class=n>j</span><span class=o>.</span><span class=n>read</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
    <span class=n>metadata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>metadata</span><span class=p>)</span>
    <span class=n>video_fp</span> <span class=o>=</span> <span class=s1>&#39;/path/to/file.bin&#39;</span>
    <span class=n>start_frame</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>end_frame</span> <span class=o>=</span> <span class=mi>1000</span>
    <span class=n>average_frame</span> <span class=o>=</span> <span class=n>load_average_frame</span><span class=p>(</span>
        <span class=n>video_fp</span><span class=p>,</span>
        <span class=n>start_frame</span><span class=p>,</span>
        <span class=n>end_frame</span><span class=p>,</span>
        <span class=n>frame_width</span> <span class=o>*</span> <span class=n>frame_height</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>dtype</span><span class=p>(</span><span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;Depth&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>itemsize</span><span class=p>,</span>
        <span class=n>np</span><span class=o>.</span><span class=n>dtype</span><span class=p>(</span><span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;Depth&#39;</span><span class=p>]),</span>
        <span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;Width&#39;</span><span class=p>],</span>
        <span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;Height&#39;</span><span class=p>]</span>
    <span class=p>)</span>
</code></pre></div> <h4 id=acquiring-data-under-this-format>Acquiring data under this format<a class=headerlink href=#acquiring-data-under-this-format title="Permanent link">&para;</a></h4> <p>Data acquisition code that generates data in this format is available from the <a href=https://github.com/AllenNeuralDynamics/FIP_DAQ_Control>data acquisition repository</a>.</p> <h3 id=relationship-to-aind-data-schema>Relationship to aind-data-schema<a class=headerlink href=#relationship-to-aind-data-schema title="Permanent link">&para;</a></h3> <p>procedures.json documents the relevant fiber probe implantation metadata (stereotaxic coordinates) and viral injection metadata (stereotaxic coordinates, materials). session.json documents the intended measurement (e.g. norepinephrine, dopamine, etc) for each channel of each probe. </p> <h3 id=file-quality-assurances>File Quality Assurances<a class=headerlink href=#file-quality-assurances title="Permanent link">&para;</a></h3> <p>The following are expected to be true for all FIP data collected under this standard:</p> <ul> <li>The number of frames in the raw binary files shall match the number of frames in the corresponding <code>CSV</code> files (e.g., <code>green.csv</code> and <code>green.bin</code>).</li> <li>The number of frames across all <code>CSV</code> files shall be the same (i.e., <code>green.csv</code> = <code>red.csv</code> = <code>iso.csv</code>) and, by extension, the number of frames in the corresponding binary files.</li> <li>Camera metadata files shall contain no dropped frames. This can be verified by checking the <code>CameraFrameNumber</code> column in the metadata files. The difference between consecutive frames must ALWAYS be 1. If a dropped frame is present, data may be corrupted and should be flagged for manual review. &gt; [!WARNING] &gt; Dropped frames are not normal and should not be taken lightly. If you encounter dropped frames, please contact the data acquisition team for further investigation.</li> <li>The difference between the derivative of <code>CameraFrameTime</code> and <code>ReferenceTime</code> is expected to be very small (i.e.: abs(max(diff(<code>CameraFrameTime</code>) - diff(<code>ReferenceTime</code>))) &lt; 0.2ms). If this is not the case, it may indicate a problem with frame exposure.</li> <li>All rows in the <code>&lt;color&gt;.csv</code> files will be present in the corresponding camera metadata files. The opposite is not guaranteed to be true.</li> <li>A <code>&lt;color&gt;.csv</code> file is not guaranteed to have a <code>Fiber_N</code> column. A <code>Background</code> column is always present. The order of the columns in the <code>&lt;color&gt;.csv</code> files is not guaranteed to be the same across different sessions. It is thus recommended to use the header as the index for the columns.</li> <li>The naming of <code>Fiber_&lt;i&gt;</code> columns in the <code>&lt;color&gt;.csv</code> files is guaranteed to be sequential, starting from <code>Fiber_0</code> and going up to <code>Fiber_N</code>.</li> <li>The <code>regions.json</code> in the FIP session are guaranteed to be static within a session. The number and order of the ROIs are expected to be the same across the two cameras.</li> </ul> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="February 10, 2026 15:57:33 UTC">February 10, 2026</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> 2025, Allen Institute for Neural Dynamics </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../..", "features": ["content.tabs.link", "announce.dismiss", "navigation.tabs", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.preview", "navigation.instant.progress", "navigation.path", "navigation.sections", "navigation.top", "navigation.tracking", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.50899def.min.js></script> </body> </html>